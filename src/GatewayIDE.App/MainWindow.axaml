<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        x:Class="GatewayIDE.App.MainWindow"
        mc:Ignorable="d"
        Width="1280" Height="800"
        Title="Gateway IDE">

  <!-- Root Grid: Topbar + Content -->
  <Grid RowDefinitions="Auto,*">

    <!-- Top bar with tabs -->
    <Border Grid.Row="0" Background="#2b2f36" Height="44">
      <Grid ColumnDefinitions="44,*,Auto,Auto,Auto,Auto,Auto" VerticalAlignment="Center">
        <!-- Toggle chat -->
        <Border Grid.Column="0" Background="Transparent" Margin="6">
          <Button Content="≡"
                  Command="{Binding ToggleChatCommand}"
                  Background="Transparent"
                  Foreground="#ddd"/>
        </Border>

        <TextBlock Grid.Column="1" Text=" " />

        <!-- Tabs -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="6" Margin="6">
          <Button Content="Dashboard" Command="{Binding SelectTabCommand}" CommandParameter="Dashboard"/>
        </StackPanel>
        <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="6" Margin="6">
          <Button Content="Docker" Command="{Binding SelectTabCommand}" CommandParameter="Docker"/>
        </StackPanel>
        <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="6" Margin="6">
          <Button Content="KI System" Command="{Binding SelectTabCommand}" CommandParameter="KI"/>
        </StackPanel>
        <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="6" Margin="6">
          <Button Content="Project" Command="{Binding SelectTabCommand}" CommandParameter="Project"/>
        </StackPanel>
        <StackPanel Grid.Column="6" Orientation="Horizontal" Spacing="6" Margin="6">
          <Button Content="Blockchain" Command="{Binding SelectTabCommand}" CommandParameter="Blockchain"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Content area: Chat-Sidebar + Main -->
    <Grid Grid.Row="1" ColumnDefinitions="Auto,*">

      <!-- Chat Sidebar (nur KI-Dialog) -->
      <Border Background="#3b3f46" Width="{Binding LeftPaneWidth}" MinWidth="0">
        <Grid RowDefinitions="*,Auto" Margin="8">

          <!-- Chat-Output -->
          <TextBox Grid.Row="0"
                   Text="{Binding ChatBuffer}"
                   TextWrapping="Wrap"
                   FontFamily="Consolas, Menlo, monospace"
                   IsReadOnly="True"
                   AcceptsReturn="True"
                   ScrollViewer.VerticalScrollBarVisibility="Auto"/>

          <!-- Chat-Eingabe -->
          <StackPanel Grid.Row="1" Spacing="6">
            <TextBox Watermark="Chat Nachricht…" Text="{Binding ChatInput, Mode=TwoWay}"/>
            <Button Content="Senden" Command="{Binding SendChatCommand}"/>
          </StackPanel>

        </Grid>
      </Border>

      <!-- Main workspace -->
      <Grid Grid.Column="1">

        <!-- DASHBOARD: Buttons oben (2/3), Terminal unten (1/3) -->
        <Grid RowDefinitions="2*,*" IsVisible="{Binding IsDashboard}">
          <!-- Buttons -->
          <ScrollViewer Grid.Row="0">
            <WrapPanel Margin="12" ItemHeight="40" ItemWidth="180">
              <!-- Nur noch Mega-Node hier -->
              <Button Content="Start Mega-Node" Command="{Binding StartMeganodeCommand}" />
            </WrapPanel>
          </ScrollViewer>

          <!-- Terminal (nur Dashboard) -->
          <Border Grid.Row="1" Margin="8" BorderBrush="#7a29ff" BorderThickness="2">
            <TextBox Text="{Binding TerminalBuffer}"
                     TextWrapping="Wrap"
                     FontFamily="Consolas, Menlo, monospace"
                     IsReadOnly="True"
                     AcceptsReturn="True"
                     Background="#0b0b0b"
                     Foreground="#d8d8d8"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"/>
          </Border>
        </Grid>

        <!-- DOCKER: Buttonleiste + zwei Terminals (stdout | stderr) -->
        <Grid IsVisible="{Binding IsDocker}" RowDefinitions="Auto,*" Margin="8">
          <!-- Buttonleiste -->
          <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
            <Button Content="Rebuild (wipe + build + up)" Command="{Binding RebuildGatewayCommand}" />
            <Button Content="Start" Command="{Binding StartGatewayCommand}" />
            <Button Content="Stop" Command="{Binding StopGatewayCommand}" />
          </StackPanel>

          <!-- zwei Terminals 50/50 -->
          <Grid Grid.Row="1" ColumnDefinitions="*,8,*">
            <Border Grid.Column="0" BorderBrush="#444" BorderThickness="1">
              <TextBox Text="{Binding DockerOutBuffer}"
                       TextWrapping="Wrap"
                       FontFamily="Consolas, Menlo, monospace"
                       IsReadOnly="True"
                       AcceptsReturn="True"
                       Background="#0b0b0b"
                       Foreground="#d8d8d8"
                       ScrollViewer.VerticalScrollBarVisibility="Auto"/>
            </Border>

            <Border Grid.Column="2" BorderBrush="#444" BorderThickness="1">
              <TextBox Text="{Binding DockerErrBuffer}"
                       TextWrapping="Wrap"
                       FontFamily="Consolas, Menlo, monospace"
                       IsReadOnly="True"
                       AcceptsReturn="True"
                       Background="#0b0b0b"
                       Foreground="#d8d8d8"
                       ScrollViewer.VerticalScrollBarVisibility="Auto"/>
            </Border>
          </Grid>
        </Grid>

      </Grid>
    </Grid>
  </Grid>
</Window>
