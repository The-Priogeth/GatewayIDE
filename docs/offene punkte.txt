# ğŸ§© GatewayIDE â€“ Offene Punkte (Refactoring & Konsolidierung)

> **Ziel:** VollstÃ¤ndige Ãœbersicht aller anstehenden Aufgaben und strukturellen MaÃŸnahmen zur Vorbereitung der Agentâ€‘HQâ€‘Integration.
> **Status:** Aktiv (Stand: 2025â€‘11â€‘08)
> **Referenzen:** [root.md](../root.md) Â· [Filestrukture.md](../Filestrukture.md) Â· [GatewayIDE_2025â€‘11â€‘08.md](../status/GatewayIDE_2025â€‘11â€‘08.md)

---

## ğŸ§­ A. Ãœberblick & Zweck

**Absicht:** Diese Datei dient als zentrales Arbeitsprotokoll fÃ¼r Refactoring, Modularisierung und Konsolidierung des GatewayIDEâ€‘Backends und der Avaloniaâ€‘App.
Sie ersetzt Ã¤ltere Textlisten und konsolidiert frÃ¼here Notizen, damit alle Aufgaben in einem strukturierten, nachvollziehbaren Format vorliegen.

**Statusâ€‘Symbole:**
ğŸŸ¢ erledigt Â· ğŸŸ  in Arbeit Â· ğŸ”¶ teils erledigt Â· ğŸ”´ offen Â· âšª geparkt

---

## ğŸ“˜ B. Dokumentation & Strukturpflege

### [DOCâ€‘01] root.md aktualisieren

**Ziel:** BlÃ¶cke fÃ¼r alle aktiv genutzten Dateien ergÃ¤nzen und abgleichen.
**Kontext:** Dokumentationsabgleich und Synchronisation mit Filestruktur.
**Betroffen:** `root.md`
**Status:** ğŸ”¶ teils erledigt
**Aktion:** BlÃ¶cke prÃ¼fen/ergÃ¤nzen fÃ¼r `backend/memory/*`, `backend/agent_core/hma/*`, `deploy/*`, `GatewayIDE.App/*`.

### [DOCâ€‘02] README / ARCHITECTURE

**Ziel:** Einstiegspunkt und technische Architektur auf aktuellen Slimâ€‘HMAâ€‘Stand bringen.
**Kontext:** Anpassung an konsolidierte Systemstruktur (Threads, Module, Routing).
**Betroffen:** `docs/README.md`, `docs/ARCHITECTURE.md`
**Status:** ğŸ”´ offen
**Quelle:** `GatewayIDE_2025â€‘11â€‘08.md` als Basis.

---

## âš™ï¸ C. Technische Hauptbereiche

### 1ï¸âƒ£ Memory & Kontextverwaltung (Zep)

#### [MEMâ€‘01] Entscheidung Zep vs. Fallback

**Ziel:** Zep vollstÃ¤ndig nutzen oder lokale Fallbacks entfernen.
**Kontext:** Vereinheitlichung der Speicherlogik (Thread+Graph) zur Fehlervermeidung.
**Betroffen:** `backend/memory/*`, `backend/bootstrap.py`, `backend/agent_core/*`
**Status:** ğŸŸ  in Arbeit
**Aktion:** `ZepMemory` als zentrale Fassade bestÃ¤tigen; lokale Fallbacks entfernen.

#### [MEMâ€‘02] APIâ€‘Nutzung & Limits

**Ziel:** LÃ¤ngenbegrenzungen (2â€¯500 Zeichen) technisch abfedern (Chunking, Summaries).
**Kontext:** Verbesserung der StabilitÃ¤t bei groÃŸen AntwortblÃ¶cken Ã¼ber Zepâ€‘API.
**Betroffen:** `backend/agent_core/hma/speaker.py`, `backend/memory/memory.py`
**Status:** ğŸ”´ offen
**Aktion:** Chunkâ€‘Write + Episodeâ€‘Summary in `add_message()` implementieren.

#### [MEMâ€‘03] Einheitlicher Kontext

**Ziel:** Nur eine Stelle baut Promptâ€‘Kontext; UI zieht Ã¼ber `/chat`â€‘Flow.
**Kontext:** ZusammenfÃ¼hrung der Kontextgenerierung zur Minimierung doppelter Speicherzugriffe.
**Betroffen:** `backend/memory/memory.py`, `backend/routes/chat_api.py`, `backend/bootstrap.py`
**Status:** ğŸ”¶ teils erledigt

---

### 2ï¸âƒ£ Agentenstruktur & Routing

#### [AGTâ€‘01] Einheitliche Agentenâ€‘API

**Ziel:** Einheitliches Interface `Agent.respond(query)` und konsistentes Antwortformat.
**Kontext:** Harmonisierung der internen Kommunikationslogik zwischen Demos und Ichâ€‘Aggregation.
**Betroffen:** `backend/agent_core/hma/hma.py`, `backend/agent_core/hma/selectors.py`
**Status:** ğŸ”¶ teils erledigt

#### [AGTâ€‘02] Speaker vs. Aggregation

**Ziel:** Trennung zwischen Aggregation (HMA) und Persistenz/Routing (Speaker).
**Kontext:** Saubere Verantwortlichkeit zwischen Datenfluss und Ergebnisaggregation.
**Betroffen:** `backend/agent_core/hma/hma.py`, `backend/agent_core/hma/speaker.py`
**Status:** ğŸ”¶ teils erledigt

#### [ROUTEâ€‘01] Routeâ€‘Parser stabilisieren

**Ziel:** `<<<ROUTE>>> {â€¦} <<<END>>>` robust parsen, Fallback: letztes JSONâ€‘Objekt mit `deliver_to`.
**Kontext:** Sicherstellung korrekter Routenauswertung bei Markdownâ€‘ oder Fenceâ€‘Formaten.
**Betroffen:** `backend/agent_core/hma/routing.py`
**Status:** ğŸ”¶ teils erledigt

---

### 3ï¸âƒ£ Backendâ€‘Aufbau & Bootstrap

#### [BOOTâ€‘01] Phasenâ€‘Bootstrap

**Ziel:** `ensure_runtime()` modularisieren (loadConfig, initMemory, initAgents, connectHMA).
**Kontext:** Stabilisierung der Startlogik und klare Ablaufstruktur fÃ¼r Initialisierung.
**Betroffen:** `backend/bootstrap.py`
**Status:** ğŸŸ  in Arbeit

#### [APIâ€‘01] Chatâ€‘Router vereinfachen

**Ziel:** Handler pro Nachrichtentyp (Dispatchâ€‘Table), zentrales Fehlerâ€‘Logging.
**Kontext:** Vereinfachung der Nachrichtenverarbeitung und Reduktion verschachtelter Bedingungen.
**Betroffen:** `backend/routes/chat_api.py`
**Status:** ğŸ”¶ teils erledigt

---

### 4ï¸âƒ£ Transport & Konfiguration (gRPC / REST)

#### [NETâ€‘01] gRPC optional halten

**Ziel:** REST/WS als produktiver Pfad, gRPC nur als Devâ€‘Double.
**Kontext:** Technische FlexibilitÃ¤t fÃ¼r zukÃ¼nftige Diensttrennung oder Streaming.
**Betroffen:** `GatewayIDE.App/*.csproj`, `protos/ai_service.proto`, `services/GatewayAI/ai_service/*`
**Status:** ğŸ”¶ teils erledigt

#### [CFGâ€‘01] ENVâ€‘Konvention

**Ziel:** Endpoints & Keys ausschlieÃŸlich aus `.env` oder Settings laden.
**Kontext:** Vermeidung von Hardcodeâ€‘Werten und Sicherstellung konfigurierbarer Laufzeitumgebungen.
**Betroffen:** `backend/bootstrap.py`, `backend/main.py`
**Status:** ğŸ”¶ teils erledigt

---

### 5ï¸âƒ£ Observability & Logging

#### [LOGâ€‘01] Einheitliches Schema

**Ziel:** Einheitliches Loggingâ€‘Schema mit `corr_id`, `thread`, `role`, `route`.
**Kontext:** Einheitliche Nachvollziehbarkeit der DatenflÃ¼sse und Fehlerpfade.
**Betroffen:** `backend/agent_core/messaging.py`, `backend/main.py`
**Status:** ğŸ”´ offen

#### [LOGâ€‘02] Fehlertrennung & Filter

**Ziel:** Getrennte Streams (stdout/stderr) und Filter nach T1â€“T6.
**Kontext:** Bessere Ãœbersicht im Logging der parallelen Threads.
**Betroffen:** `GatewayIDE.App/MainWindow.axaml` + ViewModel
**Status:** ğŸ”¶ teils erledigt

---

### 6ï¸âƒ£ UI (Avalonia)

#### [UIâ€‘01] Gridâ€‘Bindings stabilisieren

**Ziel:** Keine Stringâ€‘zuâ€‘GridLengthâ€‘Fehler; Converter zentralisieren.
**Kontext:** Korrekte Typbindung fÃ¼r Avaloniaâ€‘Layouts.
**Betroffen:** `GatewayIDE.App/ViewModels/MainWindowViewModel.cs`, `GatewayIDE.App/Converters.cs`
**Status:** ğŸ”¶ teils erledigt

#### [UIâ€‘02] Tabs entkoppeln

**Ziel:** Sichtbarkeit eines Tabs darf keine anderen Layouts beeinflussen.
**Kontext:** Isolierte Darstellung der einzelnen Arbeitsbereiche.
**Betroffen:** `GatewayIDE.App/MainWindow.axaml`, ViewModel
**Status:** ğŸ”¶ teils erledigt

#### [UIâ€‘03] KIâ€‘Systemâ€‘Telemetry

**Ziel:** T2/T4/T5/T6â€‘Boards mit Autoâ€‘Scroll & Caretâ€‘Bind implementieren.
**Kontext:** VollstÃ¤ndige Sichtbarkeit der Agentenâ€‘Kommunikation im Liveâ€‘System.
**Betroffen:** `GatewayIDE.App/MainWindow.axaml`, ViewModel
**Status:** ğŸŸ  in Arbeit

---

## ğŸ§® D. Redundanzâ€‘ & Konsolidierungsnotizen

| Thema                                               | Status                 | ZugehÃ¶riger Task / NÃ¤chster Schritt                                                      |
| :-------------------------------------------------- | :--------------------- | :--------------------------------------------------------------------------------------- |
| Memoryâ€‘Schicht (Fassade vs. zep_autogen)            | Teilweise gelÃ¶st       | [MEMâ€‘01] â€“ `zep_autogen` als KompatibilitÃ¤tsâ€‘Layer, intern auf `ZepMemory` durchreichen. |
| Routing / Threadâ€‘Mapping                            | Offen                  | Einheitliche Quelle via `/meta`â€‘Endpoint oder Konstanten.                                |
| gRPC vs REST/WS                                     | Offen                  | gRPC als Devâ€‘Double, Prod = REST/WS.                                                     |
| ProzessausfÃ¼hrung (DockerService vs ProcessManager) | Offen                  | Nur behalten, falls Nonâ€‘Dockerâ€‘Tools benÃ¶tigt.                                           |
| Kontextaufbau                                       | Weitgehend geklÃ¤rt     | Utility `context_builder.py` ergÃ¤nzen.                                                   |
| Logging / Telemetry                                 | Offen                  | Zentrales Korrelationâ€‘Schema in `messaging`.                                             |
| Build-/Runtimeâ€‘Pfad                                 | Offen                  | Prod: Dockerfileâ€‘CMD = `backend.main:app`; Devâ€‘Override dokumentieren.                   |
| Konfiguration (.env vs Hardcode)                    | Offen                  | Endpoints ausschlieÃŸlich aus ENV.                                                        |
| Zepâ€‘Graphâ€‘Operationen                               | Offen                  | `zep_autogen/graph` auf `ZepGraphAdmin` routen.                                          |
| Thread-/Userâ€‘IDs                                    | Teilweise konsolidiert | Single Source = Bootstrap.                                                               |
| gRPCâ€‘Protobuf (Client + Server)                     | Offen                  | Protobuf an einem Ort pflegen (`tests/`).                                                |
| UIâ€‘Layoutsteuerung                                  | Offen                  | Konstanten/Converter zentralisieren (`HalfConverter`).                                   |
| Devâ€‘Containerâ€‘Lifecycle                             | Offen                  | Buildâ€‘Script nur fÃ¼r Headlessâ€‘Builds; UI steuert Laufzeit.                               |
| Heuristik / Findings                                | Offen                  | Eine Entscheidungsstelle (HMAâ€‘Pfad).                                                     |
| uv.lock                                             | Offen                  | Lock neu erzeugen, Plattformâ€‘EintrÃ¤ge prÃ¼fen.                                            |

---

## ğŸ§° E. NÃ¤chste konkrete Edits

1. `GatewayIDE.txt` â†’ `docs/status/GatewayIDE_2025â€‘11â€‘08.md` migrieren (Kopf mit Datum + Konsolidierungsstatus).
2. `root.md` ergÃ¤nzen um BlÃ¶cke fÃ¼r `GatewayIDE.App/*` (prÃ¤zise Einzeiler).
3. `routing.py`: Parserâ€‘Normalizeâ€‘Step (Fence/Markdown cleanup).
4. `speaker.py`: Chunkâ€‘Write + Episodeâ€‘Summary (siehe [MEMâ€‘02]).
5. `Converters.cs`: alle Gridâ€‘GrÃ¶ÃŸen Ã¼ber zentralen Converter leiten.

---

## âœ… F. Abnahmeâ€‘Checkliste (Definition of Done)

* Alle Tasks mit Dateipfaden verknÃ¼pft (rootâ€‘BlÃ¶cke existieren).
* Build (Backend & App) fehlerfrei.
* `/chat`â€‘Flow stabil mit Kontext aus **einer** Quelle.
* Logs enthalten `corr_id`/`thread`/`role`/`route`.
* UI zeigt T2/T4/T5/T6â€‘Boards ohne Layoutâ€‘Seiteneffekte.

---

> **Hinweis:** Diese Datei wird fortlaufend gepflegt.
> Nach jeder abgeschlossenen Etappe soll der Status (ğŸŸ¢ / ğŸŸ  / ğŸ”¶ / ğŸ”´ / âšª) in den jeweiligen Unterpunkten aktualisiert werden.

